#!/usr/bin/env bash
#
#
#
e="echo"
sctle="sudo systemctl enable"
senstall="sudo pacman -Sy --noconfirm"
# Set Time ntp on systohc
sudo timedatectl set-ntp true
sudo hwclock --systohc
# Install deps for making rustup
$senstall gcc gcc-libs cmake make ninja
# Install rustup
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
# Update source in shell
source $HOME/.cargo/env

# Install pikaur
if [[ ! -d $HOME/git-builds ]]; then
    mkdir$HOME/git-builds 
    cd $HOME/git-builds || cd ... || return
    git clone https://aur.archlinux.org/pikaur.git
    cd pikaur || cd exit || return
    makepkg -si
    cd || cd ... || return
    rm -rf $HOME/git-builds/pikaur
else
    cd $HOME/git-builds || cd ... || return
    git clone https://aur.archlinux.org/pikaur.git
    cd pikaur || cd exit || return
    makepkg -si
    cd || cd ... || return
    rm -rf $HOME/git-builds/pikaur
fi

# Installing zramd and timeshift
pikaur -S zramd timeshift timeshift-autosnap
# Enabling zramd
$sctle --now zramd
# Installing starship
cargo install starship
# Installing hyprland and deps

cat $HOME/repos/arch-base-install/pkg-files/hyprpkgs.txt | while read line
do
    if [[ ${line} == '--END OF INSTALL--' ]]; then
        continue
    fi
    echo "INSTALLING: ${line}"
    pikaur -S --noconfirm --needed ${line}
done

$e "Installing Lutris Dependencies"
cat $HOME/arch-base-install/pkg-files/lutris-deps.txt | while read line
do
    if [[ ${line} == '--END OF INSTALL--' ]]; then
        continue
    fi
    $e "INSTALLING: ${line}"
    pacman -Sy --noconfirm --needed ${line}
done

# Enabling sddm service
$sctle sddm
# Todo add git repo for dot files
# git clone https://github.com/abugger1/dots.git $HOME/repos
# cd $HOME/repos/dots/ || cd exit || return
# rsync -avxAHXP --exclude '.git*' .* ~/
